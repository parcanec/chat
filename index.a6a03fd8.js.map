{"mappings":"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","sources":["scripts/network.js","node_modules/js-cookie/dist/js.cookie.js","scripts/auth.js","scripts/createMessage.js","scripts/websocket.js","main.js","scripts/changeName.js"],"sourcesContent":["import Cookies from \"js-cookie\";\r\n\r\nconst headers = {\r\n  'Content-Type': 'application/json',\r\n  Accept: \"application/json\",\r\n  mode: 'no-cors',\r\n  Authorization: `Bearer ${Cookies.get('token')}`\r\n};\r\n\r\nasync function getHistory() {\r\n  const historyUrl = 'https://edu.strada.one/api/messages/'\r\n  let response = await fetch(historyUrl, {\r\n    method: 'GET',\r\n    headers\r\n  })\r\n  const data = await response.json();\r\n  return data.messages.reverse()\r\n}\r\n\r\nasync function checkUser() {\r\n  const checkUrl = 'https://edu.strada.one/api/user/me'\r\n  let response = await fetch(checkUrl, {\r\n    method: 'GET',\r\n    headers\r\n  })\r\n  const data = await response.json();\r\n  return data\r\n}\r\n\r\nasync function updateName(name) {\r\n  const authUrl = 'https://edu.strada.one/api/user'\r\n  let response = await fetch(authUrl, {\r\n    method: 'PATCH',\r\n    body: JSON.stringify({name}),\r\n    headers\r\n  })\r\n  const data = await response.json();\r\n  return data\r\n}\r\n\r\nasync function postAuth(email) {\r\n  const authUrl = 'https://edu.strada.one/api/user'\r\n  let response = await fetch(authUrl, {\r\n    method: 'POST',\r\n    body: JSON.stringify({email}),\r\n    headers\r\n  })\r\n  const data = await response.json();\r\n  return data\r\n}\r\n\r\nexport {postAuth, updateName, getHistory, checkUser}","/*! js-cookie v3.0.1 | MIT */\n;\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global = global || self, (function () {\n    var current = global.Cookies;\n    var exports = global.Cookies = factory();\n    exports.noConflict = function () { global.Cookies = current; return exports; };\n  }()));\n}(this, (function () { 'use strict';\n\n  /* eslint-disable no-var */\n  function assign (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        target[key] = source[key];\n      }\n    }\n    return target\n  }\n  /* eslint-enable no-var */\n\n  /* eslint-disable no-var */\n  var defaultConverter = {\n    read: function (value) {\n      if (value[0] === '\"') {\n        value = value.slice(1, -1);\n      }\n      return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n    },\n    write: function (value) {\n      return encodeURIComponent(value).replace(\n        /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n        decodeURIComponent\n      )\n    }\n  };\n  /* eslint-enable no-var */\n\n  /* eslint-disable no-var */\n\n  function init (converter, defaultAttributes) {\n    function set (key, value, attributes) {\n      if (typeof document === 'undefined') {\n        return\n      }\n\n      attributes = assign({}, defaultAttributes, attributes);\n\n      if (typeof attributes.expires === 'number') {\n        attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n      }\n      if (attributes.expires) {\n        attributes.expires = attributes.expires.toUTCString();\n      }\n\n      key = encodeURIComponent(key)\n        .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n        .replace(/[()]/g, escape);\n\n      var stringifiedAttributes = '';\n      for (var attributeName in attributes) {\n        if (!attributes[attributeName]) {\n          continue\n        }\n\n        stringifiedAttributes += '; ' + attributeName;\n\n        if (attributes[attributeName] === true) {\n          continue\n        }\n\n        // Considers RFC 6265 section 5.2:\n        // ...\n        // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n        //     character:\n        // Consume the characters of the unparsed-attributes up to,\n        // not including, the first %x3B (\";\") character.\n        // ...\n        stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n      }\n\n      return (document.cookie =\n        key + '=' + converter.write(value, key) + stringifiedAttributes)\n    }\n\n    function get (key) {\n      if (typeof document === 'undefined' || (arguments.length && !key)) {\n        return\n      }\n\n      // To prevent the for loop in the first place assign an empty array\n      // in case there are no cookies at all.\n      var cookies = document.cookie ? document.cookie.split('; ') : [];\n      var jar = {};\n      for (var i = 0; i < cookies.length; i++) {\n        var parts = cookies[i].split('=');\n        var value = parts.slice(1).join('=');\n\n        try {\n          var foundKey = decodeURIComponent(parts[0]);\n          jar[foundKey] = converter.read(value, foundKey);\n\n          if (key === foundKey) {\n            break\n          }\n        } catch (e) {}\n      }\n\n      return key ? jar[key] : jar\n    }\n\n    return Object.create(\n      {\n        set: set,\n        get: get,\n        remove: function (key, attributes) {\n          set(\n            key,\n            '',\n            assign({}, attributes, {\n              expires: -1\n            })\n          );\n        },\n        withAttributes: function (attributes) {\n          return init(this.converter, assign({}, this.attributes, attributes))\n        },\n        withConverter: function (converter) {\n          return init(assign({}, this.converter, converter), this.attributes)\n        }\n      },\n      {\n        attributes: { value: Object.freeze(defaultAttributes) },\n        converter: { value: Object.freeze(converter) }\n      }\n    )\n  }\n\n  var api = init(defaultConverter, { path: '/' });\n  /* eslint-enable no-var */\n\n  return api;\n\n})));\n","import {postAuth} from \"./network\";\r\nimport Cookies from \"js-cookie\";\r\n\r\n\r\n\r\n\r\nconst autorizationModal = document.querySelector(\"#autorizationModal\")\r\nconst autorizationModalCloseButton = document.querySelector(\"#autorizationModal\").querySelector(\"#close\")\r\nconst confirmationModal = document.querySelector(\"#confirmationModal\")\r\nconst confirmationModalCloseButton = document.querySelector(\"#confirmationModal\").querySelector(\"#close\")\r\n\r\nconfirmationModalCloseButton.addEventListener('click', () => confirmationModal.classList.remove('active'))\r\nautorizationModalCloseButton.addEventListener('click', () => autorizationModal.classList.remove('active'))\r\n\r\n\r\n\r\n\r\nexport function exitChat() {\r\n  if (confirm('Вы действительно хотите выйти из чата?')) {\r\n    Cookies.remove('token')\r\n    window.location.reload()\r\n  }\r\n}\r\n\r\nexport function haveCode() {\r\n  autorizationModal.classList.remove('active')\r\n  confirmationModal.classList.add('active')\r\n}\r\n\r\nexport function sendAuth(env) {\r\n  env.preventDefault()\r\n  const email = document.querySelector('#enter_email')\r\n  const emailValue = email.value\r\n  postAuth(emailValue).then(() => {\r\n    autorizationModal.classList.remove('active')\r\n    confirmationModal.classList.add('active')\r\n  })\r\n}\r\n","import Cookies from \"js-cookie\";\r\n\r\nexport const createMessage = (isOutgingMessage, name, text, time) =>{\r\n  const chat = document.querySelector(\".middle\");\r\n  const template = document.querySelector(isOutgingMessage ? '#outgoing_message' : '#incoming_message');\r\n  let newMessage = template.content.cloneNode(true);\r\n  newMessage.querySelector(\".name\").textContent = name;\r\n  newMessage.querySelector(\".message\").textContent = text;\r\n  newMessage.querySelector(\".time\").textContent = new Date(time).toLocaleTimeString();\r\n  chat.append(newMessage)\r\n  chat.scrollTop = chat.scrollHeight;\r\n}\r\n\r\n\r\nexport function render(messages) {\r\n  for (let message of messages) {\r\n    createMessage(message.user.email === Cookies.get('myEmail'), message.user.name, message.text, message.createdAt)\r\n  }\r\n}","import Cookies from \"js-cookie\";\r\nimport {createMessage, render} from \"./createMessage\";\r\nimport {checkUser, getHistory} from \"./network\";\r\n\r\nexport function webSocket() {\r\n  const socket = new WebSocket(`wss://edu.strada.one/websockets?${Cookies.get('token')}`)\r\n  socket.onmessage = function (event) {\r\n    const dataMessage = JSON.parse(event.data)\r\n    createMessage(dataMessage.user.email === Cookies.get('myEmail'), dataMessage.user.name, dataMessage.text, dataMessage.createdAt)\r\n  };\r\n  const sendMessage = document.querySelector('.bottom')\r\n  sendMessage.addEventListener('submit', send)\r\n\r\n  function send(env) {\r\n    env.preventDefault()\r\n    let textMessage = document.querySelector('#enter_message').value\r\n    socket.send(JSON.stringify({text: `${textMessage}`}))\r\n    document.querySelector('#enter_message').value = ''\r\n  }\r\n\r\n  checkUser().then(data => Cookies.set(`myEmail`, `${data.email}`))\r\n  getHistory().then(data => render(data))\r\n  socket.onclose = () => console.log('закрыто')\r\n  socket.onopen = () => console.log('открыто')\r\n}\r\n","import Cookies from \"js-cookie\"\r\nimport {changeName} from \"./scripts/changeName\";\r\nimport {exitChat, haveCode, sendAuth} from \"./scripts/auth\";\r\nimport {webSocket} from \"./scripts/websocket\";\r\n\r\n\r\nconst chat = document.querySelector(\".middle\");\r\nchat.scrollTop = chat.scrollHeight;\r\n\r\nconst sendCode = document.querySelector('#email')\r\nsendCode.addEventListener('submit', sendAuth)\r\n\r\nconst haveCodeButton = document.querySelector('#have_code')\r\nhaveCodeButton.addEventListener('click', haveCode)\r\n\r\nconst resetSettingsButton = document.querySelector('#resetSettings')\r\nresetSettingsButton.addEventListener('click', () => console.log('reset settings complete'))\r\n\r\nconst exitButton = document.querySelector('#exit')\r\nexitButton.addEventListener('click', exitChat)\r\n\r\nconst token = document.querySelector('#enter_confirm')\r\nconst confirmToken = document.querySelector('#email_confirm')\r\n\r\nconfirmToken.addEventListener('submit', () => Cookies.set(`token`, `${token.value}`, {expires: 7}))\r\nconst autorizationModal = document.querySelector(\"#autorizationModal\")\r\nconst settingsButton = document.querySelector(\"#settings\")\r\nconst settingsModal = document.querySelector(\"#settingsModal\")\r\nconst settingsModalCloseButton = document.querySelector(\"#settingsModal\").querySelector(\"#close\")\r\nsettingsButton.addEventListener('click', () => settingsModal.classList.add('active'))\r\nsettingsModalCloseButton.addEventListener('click', () => settingsModal.classList.remove('active'))\r\n\r\nconst sendName = document.querySelector('#name')\r\nsendName.addEventListener('submit', changeName)\r\n\r\n\r\nfunction start() {\r\n  if (Cookies.get('token')) {\r\n    webSocket()\r\n  } else {\r\n    autorizationModal.classList.add('active')\r\n  }\r\n}\r\n\r\nstart()","import {updateName} from \"./network\";\r\n\r\nexport function changeName(env) {\r\n  const userName = document.querySelector('#enter_name')\r\n  env.preventDefault()\r\n  const namelValue = userName.value\r\n  document.querySelector('#enter_name').value = ''\r\n  updateName(namelValue)\r\n    .then(() => settingsModal.classList.remove('active'))\r\n\r\n}"],"names":["$8638e18fa1f96f01$var$headers","Accept","mode","Authorization","$parcel$interopDefault","$666bc8f27f76152a$exports","assign","target","i","arguments","length","source","key","init","converter","defaultAttributes","set","value","attributes","document","expires","Date","now","toUTCString","encodeURIComponent","replace","decodeURIComponent","escape","stringifiedAttributes","attributeName","split","cookie","write","get","cookies","jar","parts","slice","join","foundKey","read","e","Object","create","remove","withAttributes","this","withConverter","freeze","path","factory","async","$8638e18fa1f96f01$export$f9582a3c130d9538","response","fetch","method","json","messages","reverse","$8638e18fa1f96f01$export$77a0cf2b32e9e53d","$8638e18fa1f96f01$export$ecce8d0c2c733c65","name","body","JSON","stringify","$8638e18fa1f96f01$export$c22fa5d8c11e125","email","$2c0bbbb4ee810edf$var$autorizationModal","querySelector","$2c0bbbb4ee810edf$var$autorizationModalCloseButton","$2c0bbbb4ee810edf$var$confirmationModal","addEventListener","classList","$fb0c618a4495e1f1$export$62651879628e0c4c","isOutgingMessage","text","time","chat","newMessage","content","cloneNode","textContent","toLocaleTimeString","append","scrollTop","scrollHeight","$fb0c618a4495e1f1$export$b3890eb0ae9dca99","message","user","createdAt","$4100520e876e3dd4$export$debf5095acd2163f","socket","WebSocket","onmessage","event","dataMessage","parse","data","env","preventDefault","textMessage","send","then","onclose","console","log","onopen","$efd3ba4ec2608b1d$var$chat","add","confirm","window","location","reload","$efd3ba4ec2608b1d$var$token","$efd3ba4ec2608b1d$var$autorizationModal","$efd3ba4ec2608b1d$var$settingsButton","$efd3ba4ec2608b1d$var$settingsModal","$efd3ba4ec2608b1d$var$settingsModalCloseButton","userName","namelValue","settingsModal"],"version":3,"file":"index.a6a03fd8.js.map"}